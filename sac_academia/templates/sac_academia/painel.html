<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Painel | Mupi Academia</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">

    <style>
        :root {
            --primary: #5B6CFF;
            --primary-dark: #3F4ED9;
            --accent: #22c55e;
            --danger: #ef4444;
            --bg-body: #f8fafc;
            --text-main: #1e293b;
            --glass: rgba(255, 255, 255, 0.9);
        }

        * { box-sizing: border-box; font-family: 'Inter', sans-serif; margin: 0; padding: 0; }

        body {
            min-height: 100vh;
            background-color: var(--bg-body);
            background-image: radial-gradient(at 0% 0%, rgba(91, 108, 255, 0.05) 0px, transparent 50%), 
                              radial-gradient(at 100% 100%, rgba(91, 108, 255, 0.05) 0px, transparent 50%);
            color: var(--text-main);
        }

        header {
            background: var(--glass);
            backdrop-filter: blur(12px);
            padding: 15px 5%;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.03);
            position: sticky;
            top: 0; z-index: 100;
        }

        header h1 { font-size: 20px; font-weight: 800; }
        header h1 span { font-weight: 500; color: #64748b; font-size: 14px; }

        .btn-back {
            text-decoration: none; padding: 10px 20px;
            background: #f1f5f9; color: #475569;
            font-weight: 700; font-size: 13px; border-radius: 10px;
        }

        main { padding: 30px 5%; max-width: 1400px; margin: 0 auto; }

        .card {
            background: white; border-radius: 24px; padding: 25px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.04);
        }

        .card h2 { font-size: 22px; font-weight: 800; margin-bottom: 5px; }
        .welcome { color: #64748b; margin-bottom: 25px; font-size: 14px; }

        /* ================= FILTROS RESPONSIVOS ================= */
        .filter-section {
            display: flex; flex-wrap: wrap; gap: 10px;
            margin-bottom: 25px; padding-bottom: 20px;
            border-bottom: 1px solid #f1f5f9;
        }

        .filter-section input {
            padding: 12px; border-radius: 10px;
            border: 1px solid #e2e8f0; flex: 1; min-width: 200px;
        }

        .btn-filter {
            background: var(--primary); color: white; border: none;
            padding: 12px 20px; border-radius: 10px; font-weight: 700; cursor: pointer;
        }

        /* ================= TABELA RESPONSIVA ================= */
        .table-wrapper { border-radius: 16px; overflow: hidden; border: 1px solid #f1f5f9; }

        table { width: 100%; border-collapse: collapse; }
        thead { background: #f8fafc; }
        th { padding: 14px; text-align: left; font-size: 11px; text-transform: uppercase; color: #64748b; }
        td { padding: 16px; font-size: 14px; border-bottom: 1px solid #f8fafc; }

        .badge { padding: 4px 10px; border-radius: 20px; font-size: 10px; font-weight: 800; }
        .badge-success { background: #dcfce7; color: #15803d; }
        .badge-pending { background: #fef9c3; color: #a16207; }

        .btn-action {
            padding: 8px 12px; border-radius: 8px; font-size: 12px;
            font-weight: 700; border: none; cursor: pointer; margin-left: 5px;
        }
        .btn-read { background: #e0e7ff; color: var(--primary-dark); }
        .btn-delete { background: #fee2e2; color: #b91c1c; }

        /* MODO CELULAR (TABELA VIRA CARDS) */
        @media (max-width: 768px) {
            header { flex-direction: column; gap: 15px; text-align: center; }
            
            table, thead, tbody, th, td, tr { display: block; }
            
            thead tr { position: absolute; top: -9999px; left: -9999px; }
            
            tr {
                border: 1px solid #edf2f7;
                border-radius: 15px;
                margin-bottom: 15px;
                padding: 10px;
                background: #fff;
            }
            
            td {
                border: none;
                position: relative;
                padding-left: 50% !important;
                text-align: right;
                border-bottom: 1px solid #f7fafc;
            }
            
            td:last-child { border-bottom: none; text-align: center; padding-left: 16px !important; }

            /* Legendas das colunas */
            td:before {
                position: absolute;
                top: 16px; left: 16px;
                width: 45%; padding-right: 10px;
                white-space: nowrap;
                content: attr(data-label);
                text-align: left;
                font-weight: 700;
                font-size: 11px;
                text-transform: uppercase;
                color: #94a3b8;
            }

            .btn-action { margin: 5px; width: 45%; }
        }

        .pagination { margin-top: 25px; display: flex; justify-content: center; gap: 8px; }
        .pagination a { 
            text-decoration: none; padding: 8px 14px; background: white; 
            border: 1px solid #e2e8f0; border-radius: 8px; color: #475569; font-size: 14px;
        }

        footer { margin-top: 40px; text-align: center; font-size: 12px; color: #94a3b8; padding-bottom: 20px; }
    </style>
</head>

<body>
<header>
    <h1>Mupi Academia <span>| Painel</span></h1>
    <a href="{% url 'sac_academia:landpage' %}" class="btn-back">Sair do Painel</a>
</header>

<main>
    <div class="card">
        <h2>Mensagens</h2>
        <p class="welcome">Logado como: <strong>{{ request.user.username }}</strong></p>

        <form method="get" class="filter-section">
            <input type="text" name="q" placeholder="Buscar..." value="{{ request.GET.q }}">
            <input type="date" name="data_inicio" value="{{ request.GET.data_inicio }}">
            <button type="submit" class="btn-filter">Filtrar</button>
            {% if request.GET %}<a href="{% url 'sac_academia:painel' %}" style="font-size: 12px; color: #64748b; align-self: center;">Limpar</a>{% endif %}
        </form>

        {% if mensagens %}
            <div class="table-wrapper">
                <table>
                    <thead>
                        <tr>
                            <th>Usuário</th>
                            <th>Mensagem</th>
                            <th>Data</th>
                            <th>Status</th>
                            <th style="text-align: right;">Ações</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for msg in mensagens %}
                            <tr>
                                <td data-label="Usuário">
                                    <strong>{{ msg.nome }}</strong><br>
                                    <small style="color: #64748b;">{{ msg.email }}</small>
                                </td>
                                <td data-label="Mensagem">{{ msg.mensagem }}</td>
                                <td data-label="Data">{{ msg.data_envio|date:"d/m/y H:i" }}</td>
                                <td data-label="Status">
                                    {% if msg.lida %}
                                        <span class="badge badge-success">Lida</span>
                                    {% else %}
                                        <span class="badge badge-pending">Nova</span>
                                    {% endif %}
                                </td>
                                <td style="text-align: right;">
                                    {% if not msg.lida %}
                                        <form action="{% url 'sac_academia:marcar_lida' msg.id %}" method="POST" style="display:inline;">
                                            {% csrf_token %}
                                            <button type="submit" class="btn-action btn-read">Lida</button>
                                        </form>
                                    {% endif %}
                                    <form action="{% url 'sac_academia:deletar_mensagem' msg.id %}" method="POST" style="display:inline;">
                                        {% csrf_token %}
                                        <button type="submit" class="btn-action btn-delete" onclick="return confirm('Excluir?')">Excluir</button>
                                    </form>
                                </td>
                            </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        {% else %}
            <div style="text-align:center; padding: 40px; color: #94a3b8;">Nenhuma mensagem encontrada.</div>
        {% endif %}
    </div>

    {% if mensagens.paginator.num_pages > 1 %}
        <div class="pagination">
            {% if mensagens.has_previous %}
                <a href="?page={{ mensagens.previous_page_number }}">Anterior</a>
            {% endif %}
            <a href="#" style="background: var(--primary); color: white; border: none;">{{ mensagens.number }}</a>
            {% if mensagens.has_next %}
                <a href="?page={{ mensagens.next_page_number }}">Próxima</a>
            {% endif %}
        </div>
    {% endif %}

    <footer>© 2026 Mupi Academia</footer>
</main>
</body>
</html>